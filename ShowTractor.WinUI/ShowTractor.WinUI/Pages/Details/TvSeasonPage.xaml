<c:NavigationPage
    x:Class="ShowTractor.WinUI.Pages.Details.TvSeasonPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="using:ShowTractor.WinUI.Behaviors"
    xmlns:c="using:ShowTractor.WinUI.Controls"
    xmlns:e="using:ShowTractor.WinUI.Extensions"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:vm="using:ShowTractor.Pages.Details"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d" d:DataContext="{d:DesignInstance Type=vm:TvSeasonPageViewModel}"
    Background="{ThemeResource NavigationViewTopPaneBackground}">
    <Page.Resources>
        <e:ScopedServiceProvider x:Key="ScopedServiceProvider" ParentProvider="{StaticResource ServiceProvider}"/>
        <x:Double x:Key="Breakpoint640Plus">641</x:Double>
        <x:Double x:Key="HeaderMaxHeight">300</x:Double>
        <Style x:Key="TitleTextBlockStyle" TargetType="TextBlock" BasedOn="{StaticResource BaseTextBlockStyle}">
            <Setter Property="Margin" Value="0 30 0 12"/>
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="24" />
            <Setter Property="OpticalMarginAlignment" Value="TrimSideBearings" />
        </Style>
    </Page.Resources>
    <c:NavigationPage.DataContext>
        <e:FromServiceProviderExtension
            ServiceProvider="{StaticResource ScopedServiceProvider}"
            TypeName="ShowTractor.Pages.Details.TvSeasonPageViewModel, ShowTractor"/>
    </c:NavigationPage.DataContext>
    <Grid x:Name="grid">
        <VisualStateManager.VisualStateGroups>
            <!--  Visual states reflect the application's window size  -->
            <VisualStateGroup x:Name="LayoutVisualStates">
                <VisualState x:Name="WideLayout">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="{StaticResource Breakpoint640Plus}" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <!-- TODO -->
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="NarrowLayout">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <!-- TODO -->
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        <ScrollViewer x:Name="scrollViewer">
            <StackPanel>
                <ParallaxView x:Name="headerImageView" Height="{StaticResource HeaderMaxHeight}" Source="{x:Bind scrollViewer}" VerticalShift="350">
                    <ParallaxView.Child>
                        <Image x:Name="headerImage" HorizontalAlignment="Center" Source="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).Artwork, Converter={StaticResource ArtworkToImageSourceConverter}, Mode=OneWay}" Stretch="UniformToFill" />
                    </ParallaxView.Child>
                </ParallaxView>
                <StackPanel Margin="24" MaxWidth="1600">
                    <TextBlock Style="{StaticResource TitleTextBlockStyle}">Show Description</TextBlock>
                    <TextBlock Style="{StaticResource BodyTextBlockStyle}" Text="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).ShowDescription, Mode=OneWay}" MaxWidth="600" HorizontalAlignment="Left"/>
                    <TextBlock Style="{StaticResource TitleTextBlockStyle}">Episodes</TextBlock>
                    <ItemsControl ItemsSource="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).Episodes, Mode=OneWay}">
                        <ItemsControl.Resources>
                            <SolidColorBrush x:Key="ButtonBackground" Color="#00FFFFFF"/>
                            <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="Black" Opacity="0.3"/>
                            <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="Black" Opacity="0.5"/>
                            <SolidColorBrush x:Key="ButtonBackgroundDisabled" Color="{StaticResource SystemAltMediumLowColor}"/>
                        </ItemsControl.Resources>
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="FrameworkElement">
                                <Setter Property="Margin" Value="0 12"/>
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:TvEpisodeViewModel">
                                <Grid Background="White" MinHeight="120">
                                    <Grid.Shadow>
                                        <ThemeShadow/>
                                    </Grid.Shadow>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Image Grid.RowSpan="2" Source="{x:Bind Artwork, Converter={StaticResource ArtworkToImageSourceConverter}, Mode=OneWay}" Stretch="UniformToFill" />
                                    <StackPanel Grid.Column="1" Grid.RowSpan="2" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="12">
                                        <StackPanel.ContextFlyout>
                                            <MenuFlyout>
                                                <MenuFlyoutItem Text="Copy" Click="MenuFlyoutCopy_Click"/>
                                            </MenuFlyout>
                                        </StackPanel.ContextFlyout>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Episode" Padding="0 0 3 0" Style="{StaticResource CaptionTextBlockStyle}"/>
                                            <TextBlock Text="{x:Bind EpisodeNumber}" Style="{StaticResource CaptionTextBlockStyle}"/>
                                        </StackPanel>
                                        <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="{x:Bind Name, Mode=OneWay}"/>
                                        <TextBlock Style="{StaticResource BodyTextBlockStyle}" Text="{x:Bind Description, Mode=OneWay}"/>
                                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}" Text="{x:Bind TagsDisplayText, Mode=OneWay}" Opacity="0.5"/>
                                    </StackPanel>
                                    <ProgressBar 
                                        Grid.Column="2" Grid.ColumnSpan="2" Margin="6"
                                        Visibility="{x:Bind ShowWatchProgress, Mode=OneWay}"
                                        Value="{x:Bind WatchProgressPercentage, Mode=OneWay}"/>
                                    <StackPanel Grid.Column="2" Grid.Row="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Visibility="Collapsed">
                                        <FontIcon Glyph="&#xE783;"/>
                                        <TextBlock LineHeight="22" Margin="3 0">Unavailable</TextBlock>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Grid.Row="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Visibility="Collapsed">
                                        <Button HorizontalAlignment="Center" Margin="6 0">
                                            <FontIcon Glyph="&#xE896;" ToolTipService.ToolTip="Download"/>
                                        </Button>
                                    </StackPanel>
                                    <Button Grid.Column="3" Grid.Row="1" Visibility="{x:Bind ShowWatchProgress, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
                                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE712;"/>
                                        <Button.Flyout>
                                            <MenuFlyout Placement="Bottom">
                                                <MenuFlyoutItem 
                                                    Text="Mark as watched" 
                                                    Visibility="{x:Bind MarkAsWatchedEnabled, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"
                                                    Command="{x:Bind MarkAsWatched}"/>
                                                <MenuFlyoutItem
                                                    Text="Mark as unwatched" 
                                                    Visibility="{x:Bind MarkAsWatchedEnabled, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, Mode=OneWay}"
                                                    Command="{x:Bind MarkAsUnwatched}"/>
                                            </MenuFlyout>
                                        </Button.Flyout>
                                    </Button>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
        <c:HeaderControl x:Name="headerControl" ScrollViewer="{x:Bind scrollViewer}" MaxHeight="{StaticResource HeaderMaxHeight}" VerticalAlignment="Top" HeaderMinHeight="123">
            <Rectangle x:Name="WideBackground" IsHitTestVisible="False">
                <Rectangle.Fill>
                    <AcrylicBrush TintOpacity="0.9" TintColor="#FF000000" FallbackColor="SaddleBrown"/>
                </Rectangle.Fill>
            </Rectangle>
            <Grid x:Name="headerRoot">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Image x:Name="poster" Grid.RowSpan="2" Margin="30 10" IsHitTestVisible="False" Source="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).Artwork, Converter={StaticResource ArtworkToImageSourceConverter}, Mode=OneWay}">
                    <i:Interaction.Behaviors>
                        <b:AutoImageWidthBehavior/>
                    </i:Interaction.Behaviors>
                </Image>
                <StackPanel Grid.Column="1" Orientation="Vertical" IsHitTestVisible="False">
                    <TextBlock Style="{StaticResource HeaderTextBlockStyle}" Foreground="White" Text="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).ShowName, Mode=OneWay}" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis">
                        <i:Interaction.Behaviors>
                            <b:ScrollViewerHeaderBehavior ScrollHeight="180" MaximumFontSize="46" MinimumFontSize="36" ScrollViewer="{x:Bind scrollViewer}"/>
                        </i:Interaction.Behaviors>
                    </TextBlock>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Style="{StaticResource BaseTextBlockStyle}" Foreground="White" Text="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).TagsDisplayText, Mode=OneWay}"/>
                        <Grid Background="DarkOrange" HorizontalAlignment="Left" Padding="5 2" CornerRadius="3" Margin="5 0"
                              Visibility="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).ShowFinale, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
                            <TextBlock Foreground="White" Text="Series Finale" FontSize="12" FontWeight="Bold"/>
                        </Grid>
                    </StackPanel>
                    <TextBlock Style="{StaticResource BodyTextBlockStyle}" Foreground="White" Text="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).SeasonDescription, Mode=OneWay}"/>
                </StackPanel>
                <Border x:Name="commandBarBorder" Grid.Column="1" Grid.Row="1">
                    <Border.Resources>
                        <SolidColorBrush x:Key="CommandBarBackground" Color="#00FFFFFF"/>
                        <SolidColorBrush x:Key="CommandBarEllipsisIconForegroundDisabled" Color="{StaticResource SystemAltMediumLowColor}"/>
                        <SolidColorBrush x:Key="AppBarEllipsisButtonBackground" Color="White" Opacity="0"/>
                        <SolidColorBrush x:Key="AppBarEllipsisButtonBackgroundPointerOver" Color="White" Opacity="0.3"/>
                        <SolidColorBrush x:Key="AppBarEllipsisButtonBackgroundPressed" Color="White" Opacity="0.5"/>
                        <SolidColorBrush x:Key="AppBarEllipsisButtonBackgroundDisabled" Color="{StaticResource SystemAltMediumLowColor}"/>
                        <SolidColorBrush x:Key="AppBarEllipsisButtonForeground" Color="White"/>
                        <SolidColorBrush x:Key="AppBarEllipsisButtonForegroundPointerOver" Color="White"/>
                        <SolidColorBrush x:Key="AppBarEllipsisButtonForegroundPressed" Color="White"/>
                        <SolidColorBrush x:Key="AppBarEllipsisButtonForegroundDisabled" Color="{StaticResource SystemAltMediumLowColor}"/>
                        <SolidColorBrush x:Key="CommandBarForeground" Color="White"/>
                        <SolidColorBrush x:Key="AppBarButtonBackground" Color="#00FFFFFF"/>
                        <SolidColorBrush x:Key="AppBarButtonBackgroundPointerOver" Color="White" Opacity="0.3"/>
                        <SolidColorBrush x:Key="AppBarButtonBackgroundPressed" Color="White" Opacity="0.5"/>
                        <SolidColorBrush x:Key="AppBarButtonBackgroundDisabled" Color="{StaticResource SystemAltMediumLowColor}"/>
                        <SolidColorBrush x:Key="AppBarButtonForeground" Color="White"/>
                        <SolidColorBrush x:Key="AppBarButtonForegroundPointerOver" Color="White"/>
                        <SolidColorBrush x:Key="AppBarButtonForegroundPressed" Color="White"/>
                        <SolidColorBrush x:Key="AppBarButtonForegroundDisabled" Color="{StaticResource SystemAltMediumLowColor}"/>
                    </Border.Resources>
                    <c:CommandBar Background="Transparent" IsOpen="False" DefaultLabelPosition="Right" HorizontalAlignment="Left" Margin="0 6">
                        <AppBarButton 
                            Icon="Add" Label="Follow" CornerRadius="20" Margin="6 0"
                            Command="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).FollowCommand}"
                            Visibility="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).Following, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=True, Mode=OneWay}"/>
                        <AppBarButton 
                            Icon="Remove" Label="Unfollow" CornerRadius="20" Margin="6 0"
                            Command="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).UnfollowCommand}"
                            Visibility="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).Following, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"/>
                        <AppBarButton Icon="Download" Label="Download" CornerRadius="20" Margin="6 0" Visibility="Collapsed">
                            <AppBarButton.Flyout>
                                <MenuFlyout Placement="Bottom">
                                    <MenuFlyoutItem Text="Download All" />
                                    <MenuFlyoutItem Text="Download Unwatched"/>
                                </MenuFlyout>
                            </AppBarButton.Flyout>
                        </AppBarButton>
                        <AppBarButton Icon="Play" Label="Play" CornerRadius="20" Margin="6 0" Visibility="Collapsed"/>
                        <AppBarButton Label="Resume" CornerRadius="20" Margin="6 0" Visibility="Collapsed">
                            <AppBarButton.Icon>
                                <FontIcon Glyph="&#xEF3B;"/>
                            </AppBarButton.Icon>
                        </AppBarButton>
                        <AppBarButton Icon="Edit" Label="Mark" CornerRadius="20" Margin="6 0" Visibility="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).Following, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
                            <AppBarButton.Flyout>
                                <MenuFlyout Placement="Bottom">
                                    <MenuFlyoutItem 
                                        Text="Mark season as watched" 
                                        Command="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).MarkSeasonAsWatched}"
                                        IsEnabled="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).MarkSeasonAsWatchedEnabled, Mode=OneWay}"/>
                                    <MenuFlyoutItem 
                                        Text="Mark season as Unwatched" 
                                        Command="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).MarkSeasonAsUnwatched}"
                                        IsEnabled="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).MarkSeasonAsUnwatchedEnabled, Mode=OneWay}"/>
                                    <MenuFlyoutItem 
                                        Text="Mark entire show as Watched"
                                        Command="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).MarkAllSeasonsAsWatched}"
                                        IsEnabled="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).MarkAllSeasonsAsWatchedEnabled, Mode=OneWay}"/>
                                    <MenuFlyoutItem 
                                        Text="Mark entire show as Unwatched"
                                        Command="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).MarkAllSeasonsAsUnwatched}"
                                        IsEnabled="{x:Bind ((vm:TvSeasonPageViewModel)grid.DataContext).MarkAllSeasonsAsUnwatchedEnabled, Mode=OneWay}"/>
                                </MenuFlyout>
                            </AppBarButton.Flyout>
                        </AppBarButton>
                        <AppBarButton Icon="Delete" Label="Delete Files" CornerRadius="20" Margin="6 0" Visibility="Collapsed">
                            <AppBarButton.Flyout>
                                <MenuFlyout Placement="Bottom">
                                    <MenuFlyoutItem Text="Delete Watched" />
                                    <MenuFlyoutItem Text="Delete All"/>
                                </MenuFlyout>
                            </AppBarButton.Flyout>
                        </AppBarButton>
                    </c:CommandBar>
                </Border>
            </Grid>
        </c:HeaderControl>
    </Grid>
</c:NavigationPage>
